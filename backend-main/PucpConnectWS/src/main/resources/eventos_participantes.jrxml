<!-- Created with Jaspersoft Studio version 7.0.3.final using JasperReports Library version 7.0.3-41034ca841d452f3305ba55b9042260aaa1ab5dd  -->
<jasperReport name="eventos_participantes" language="java" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="eea088be-e670-4b74-9a58-5552387f2db2">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="PucpTest"/>
	<style name="Title" forecolor="#FFFFFF" backcolor="#3366CC" fontName="Arial" fontSize="16.0" bold="true"/>
	<style name="Subtitle" forecolor="#333333" fontName="Arial" fontSize="12.0"/>
	<style name="TableHeader" mode="Opaque" forecolor="#FFFFFF" backcolor="#4285F4" fontName="Arial" fontSize="10.0" bold="true"/>
	<style name="TableDetail" forecolor="#333333" fontName="Arial" fontSize="10.0"/>
	<style name="EventFooter" forecolor="#4285F4" fontName="Arial" fontSize="10.0" bold="true"/>
	<style name="ReportFooter" forecolor="#333333" fontName="Arial" fontSize="10.0" bold="true"/>
	<query language="sql"><![CDATA[SELECT 
    e.idEvento,
    e.nombre AS nombre_evento,
    e.fecha AS fecha_evento,
    e.ubicacion AS ubicacion_evento,
    u_creador.nombre AS nombre_creador,
    u_part.nombre AS nombre_participante,
    COALESCE(a_part.carrera, 'No registrada') AS carrera_participante,
    COALESCE(a_part.ubicacion, 'No registrada') AS ubicacion_participante,
    COALESCE(a_part.edad, '-') AS edad,
    (SELECT COUNT(DISTINCT e2.idEvento) FROM Evento e2 WHERE e2.estado = TRUE) AS total_eventos,
    (SELECT COUNT(DISTINCT ep2.idUsuario) FROM Evento_Participante ep2 WHERE ep2.idEvento = e.idEvento AND (ep2.estado IS NULL OR ep2.estado = TRUE)) AS participantes_evento
FROM Evento e
INNER JOIN Alumno a_creador ON e.creador_id = a_creador.idUsuario
INNER JOIN Usuario u_creador ON a_creador.idUsuario = u_creador.idUsuario
LEFT JOIN Evento_Participante ep ON e.idEvento = ep.idEvento
LEFT JOIN Alumno a_part ON ep.idUsuario = a_part.idUsuario
LEFT JOIN Usuario u_part ON a_part.idUsuario = u_part.idUsuario
WHERE e.estado = TRUE AND (ep.estado IS NULL OR ep.estado = TRUE)
ORDER BY e.fecha DESC, e.nombre, u_part.nombre]]></query>
	<field name="idEvento" class="java.lang.Integer"/>
	<field name="nombre_evento" class="java.lang.String"/>
	<field name="fecha_evento" class="java.util.Date"/>
	<field name="ubicacion_evento" class="java.lang.String"/>
	<field name="nombre_creador" class="java.lang.String"/>
	<field name="nombre_participante" class="java.lang.String"/>
	<field name="carrera_participante" class="java.lang.String"/>
	<field name="ubicacion_participante" class="java.lang.String"/>
	<field name="edad" class="java.lang.String"/>
	<field name="total_eventos" class="java.lang.Integer"/>
	<field name="participantes_evento" class="java.lang.Integer"/>
	<variable name="current_event_id" resetType="Group" resetGroup="EventoGroup" class="java.lang.Integer">
		<expression><![CDATA[$F{idEvento}]]></expression>
	</variable>
	<group name="EventoGroup">
		<expression><![CDATA[$F{idEvento}]]></expression>
		<groupHeader>
			<band height="80">
				<element kind="textField" uuid="2c7fc2c8-aba5-4074-ba7f-a115f613cb1d" x="5" y="30" width="535" height="15" style="Subtitle">
					<expression><![CDATA["Fecha: " + $F{fecha_evento} + "   |   Ubicación: " + $F{ubicacion_evento} + "   |   Organizador: " + $F{nombre_creador}]]></expression>
				</element>
				<element kind="rectangle" uuid="fb3b92b0-e266-4869-b8b7-0e7f9b0c2db8" x="0" y="48" width="459" height="25" backcolor="#4285F4"/>
				<element kind="staticText" uuid="c467b466-83a7-406d-90f2-79c5f815eee9" x="5" y="50" width="144" height="20" vTextAlign="Middle" style="TableHeader">
					<text><![CDATA[Participante]]></text>
				</element>
				<element kind="staticText" uuid="4381378a-19ee-4888-af2f-9a2a0313531d" x="150" y="50" width="150" height="20" vTextAlign="Middle" style="TableHeader">
					<text><![CDATA[Carrera]]></text>
				</element>
				<element kind="staticText" uuid="51b24226-0e41-49ab-94c6-60f8f308f6c3" x="300" y="50" width="100" height="20" vTextAlign="Middle" style="TableHeader">
					<text><![CDATA[Ubicación]]></text>
				</element>
				<element kind="staticText" uuid="07f9ad31-a87c-496b-93f8-8c05ae2e13bd" x="400" y="50" width="50" height="20" vTextAlign="Middle" style="TableHeader">
					<text><![CDATA[Edad]]></text>
				</element>
				<element kind="rectangle" uuid="3999e23d-c74b-4de2-88f5-4d2c124180fe" x="0" y="0" width="555" height="25" backcolor="#3366CC"/>
				<element kind="textField" uuid="0ddba567-9193-47b8-8b77-a2050c592063" x="10" y="5" width="530" height="20" forecolor="#FFFFFF" fontSize="13.0" style="Title">
					<expression><![CDATA[$F{nombre_evento}]]></expression>
				</element>
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="30">
				<element kind="textField" uuid="99046e27-9b20-48bf-a9d6-f5012730eeeb" x="0" y="5" width="216" height="20" style="EventFooter">
					<expression><![CDATA["Participantes: " + $F{participantes_evento}]]></expression>
				</element>
			</band>
		</groupFooter>
	</group>
	<title height="147">
		<element kind="rectangle" uuid="c1562ec2-4098-44cf-a9b4-d3f8f7376298" x="0" y="0" width="555" height="50" backcolor="#3366CC"/>
		<element kind="rectangle" uuid="0898b429-f785-4c58-8929-23d0784f18a0" x="0" y="60" width="555" height="25" backcolor="#3366CC"/>
		<element kind="textField" uuid="e6390ab9-cb2a-4ba6-b9f0-2ce2f89d56ea" x="62" y="91" width="155" height="20" pattern="dd/MM/yyyy HH:mm">
			<expression><![CDATA[new java.util.Date()]]></expression>
		</element>
		<element kind="staticText" uuid="79f7917c-e80f-43ed-9795-6b94b660ebb6" x="1" y="91" width="62" height="20">
			<text><![CDATA[Generado el:]]></text>
		</element>
		<element kind="staticText" uuid="fbc0e4aa-d7e2-430c-aae3-d2ee57af9013" x="10" y="10" width="190" height="30" forecolor="#FFFFFF" fontSize="22.0">
			<text><![CDATA[PUCPCONNECT]]></text>
		</element>
		<element kind="staticText" uuid="259109c9-a204-4d02-b91f-8d4432fd4285" x="10" y="60" width="260" height="24" forecolor="#FFFFFF" fontSize="16.0">
			<text><![CDATA[Reporte participantes de eventos]]></text>
		</element>
		<element kind="staticText" uuid="8a7f1731-3109-4f0d-a42c-2aa058d43c98" x="0" y="117" width="554" height="30">
			<text><![CDATA[Reporte de participantes de todos los eventos mostrando la fecha, ubicación, por quien fue organizado. Además por cada participante muestra el nombre, carrera, ubicación y edad.]]></text>
		</element>
	</title>
	<columnHeader height="10">
		<property name="com.jaspersoft.studio.unit.height" value="px"/>
	</columnHeader>
	<detail>
		<band height="25">
			<element kind="textField" uuid="423ca5a8-ab02-43d7-aea2-7ecd46f9c69b" x="5" y="5" width="150" height="20" style="TableDetail">
				<expression><![CDATA[$F{nombre_participante}]]></expression>
			</element>
			<element kind="textField" uuid="0e80ab7b-cfdf-4740-b66b-abaeb54b2d23" x="155" y="5" width="150" height="20" style="TableDetail">
				<expression><![CDATA[$F{carrera_participante}]]></expression>
			</element>
			<element kind="textField" uuid="1b0daf22-de56-40ee-84be-57cb25c6864f" x="305" y="5" width="100" height="20" style="TableDetail">
				<expression><![CDATA[$F{ubicacion_participante}]]></expression>
			</element>
			<element kind="textField" uuid="a9c14bd6-fbaa-411e-9050-3764dd4c5aa6" x="405" y="5" width="50" height="20" style="TableDetail">
				<expression><![CDATA[$F{edad}]]></expression>
			</element>
			<element kind="line" uuid="cc8650bf-b7fe-4161-b459-908d0a7f8da9" x="0" y="24" width="555" height="1" forecolor="#E0E0E0"/>
		</band>
	</detail>
	<summary height="50">
		<element kind="textField" uuid="1b0daf22-de56-40ee-84be-57cb25c6864f" x="0" y="10" width="555" height="20" style="ReportFooter">
			<expression><![CDATA["Total de eventos diferentes: " + $F{total_eventos}]]></expression>
		</element>
		<element kind="staticText" uuid="a9c14bd6-fbaa-411e-9050-3764dd4c5aa6" x="0" y="30" width="555" height="20" style="ReportFooter">
			<text><![CDATA[© " + new java.text.SimpleDateFormat("yyyy").format(new java.util.Date()) + " - Todos los derechos reservados]]></text>
		</element>
	</summary>
</jasperReport>
